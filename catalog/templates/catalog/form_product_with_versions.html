{% extends 'catalog/base.html' %}

{% block content %}

    {% load catalog_filters %}

    <form method="post" enctype="multipart/form-data">
        <div class="row">
            <div class="col-lg-5 col-md-12 col-sm-12">
                <div class="card mb-4 box-shadow">
                    <div class="card-header">
                        {% if object.get_absolute_url %}
                    <h2>Редактирование продукта</h2>
                            {% else %}
                            <h2>Создание продукта</h2>
                        {% endif %}
                    </div>
                    <div class="card-body">
                            {% csrf_token %}
                            {{ form.non_field_errors }}
                            {{ form.as_p }}
                            <div class="text-center">
                                <button class="btn btn-outline-primary w-50" type="submit">Сохранить</button>
                            </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-7 col-md-12 col-sm-12">
                <div class="card">
                    <div class="card-header">
                            <h5>Укажите версии продукта</h5>
                    </div>
                    <div class="card-body">
                        <div class="formset">
                         <div class="form-error text-danger"><strong>{{ form.error_status }}</strong></div>
                        {{ formset.management_form }}

                            {% for form in formset.forms %}
                                    <div class="formset_row">
                                        {% for field in form.visible_fields %}
                                                <div class="formset-col">
                                                    {% if forloop.first %}
                                                        {% for hidden in form.hidden_fields %}
                                                            {{ hidden }}
                                                        {% endfor %}
                                                    {% endif %}
                                                    {% if not forloop.last %}
                                                        <p>{{ field.label }}
                                                    {% endif %}
                                                    {{ field }}
                                                    <div class="form-error text-danger">{{ field.errors }}</div>
                                                </div>
                                        {% endfor %}
                                </div>
                           {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>

<script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.formset/1.2.2/jquery.formset.js"
        integrity="sha512-Tsdobfrx6IMRPi8d5z3AtjWNSbZxGm58IZFnblaRaepw562ZITlRhUM2Zu87vbvZjQxGmmto+31zEBLZ4wjs+w=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
    $('.formset_row').formset({
        addText: '<span class="btn btn-outline-primary w-50">Добавить версию</span>',
        deleteText: '<span class="btn btn-outline-danger w-50">Удалить версию</span>',
        prefix: 'tag_set',
    });
</script>

{% endblock %}