{% extends 'catalog/base.html' %}

{% block content %}

    {% load catalog_filters %}
    {% load catalog_tags %}

    <head>
      <title>Форма продукта - создание и редактирование</title>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    {{ form.media }}
    </head>

    <form method="post" enctype="multipart/form-data">
        <div class="row">
            <div class="col-lg-5 col-md-12 col-sm-12">
                <div class="card mb-4 box-shadow border-warning">
                    <div class="card-header text-bg-warning">
                        {% if object.get_absolute_url %}
                    <h2>Редактирование продукта</h2>
                            {% else %}
                            <h2>Создание продукта</h2>
                        {% endif %}
                    </div>
                    <div class="card-body">
                        {% csrf_token %}
                        {{ form.as_p }}
                        <div class="card-footer text-center border-0">
                            <button class="btn btn-outline-primary w-50" type="submit"><strong>Сохранить</strong></button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-7 col-md-12 col-sm-12">
                <div class="card border-warning">
                    <div class="card-header text-bg-warning">
                            <h5>Добавьте версии продукта</h5>
                    </div>
                    <div class="card-body">
                        <div class="formset">
                         <div class="form-error text-danger">{% cleanversionerror formset.errors %}</div>
                        {{ formset.management_form }}
                            {% for form in formset.forms %}
                                    <div class="formset_row row">
                                        {% for field in form.visible_fields %}
                                                <div class="formset-col {% if forloop.counter == 1 %}col-2
                                                                        {% elif forloop.counter == 2 %}col-8
                                                                        {% elif forloop.counter == 3 %}col-2
                                                                        {% endif %}">
                                                    {% if forloop.first %}
                                                        {% for hidden in form.hidden_fields %}
                                                            {{ hidden }}
                                                        {% endfor %}
                                                    {% endif %}
                                                    {% if not forloop.last %}
                                                        <p>{{ field.label }}</p>
                                                    {% endif %}
                                                 {{ field }}
                                                    <span class="helptext">{{ field.help_text }}</span>
                                                    <div class="form-error text-danger">{{ field.errors }}</div>
                                                </div>
                                        {% endfor %}
                                </div>
                           {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>

<script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.formset/1.2.2/jquery.formset.js"
        integrity="sha512-Tsdobfrx6IMRPi8d5z3AtjWNSbZxGm58IZFnblaRaepw562ZITlRhUM2Zu87vbvZjQxGmmto+31zEBLZ4wjs+w=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
    $('.formset_row').formset({
        {#addText: '<span class="btn btn-outline-primary w-50">Добавить версию</span>',#}
        deleteText: '<span class="btn btn-outline-danger w-25">Удалить версию</span>',
        prefix: 'tag_set',
    });
</script>

{% endblock %}